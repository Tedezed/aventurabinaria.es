<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Aventura Binaria</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/css/theme_v2.css" rel="stylesheet" type="text/css">
    <link href="/css/syntax.css" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" type="image/png" href="https://www.aventurabinaria.es/images/favicon-32x32.png"/>


</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Aventura Binaria</a>
              </div>
              <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <!--<li class="active"><a href="/">Home</a></li>-->
                    <li class="active visible-xs-block"><a href="/links.html">Links</a></li>
                    <li class="nav-item"><a class="nav-link" href="/archive.html">Archive</a></li>
                    <!--<li class="active"><a href="/about.html">About</a></li>-->
                    <!--<li class="active"><a href="/space.html">Space</a></li>-->
                    
                    
                      <li class="nav-item"><a class="nav-link" href="https://github.com/Tedezed">Github</a></li>
                    
                    <li class="nav-item"><a class="nav-link" href="/feed.xml">RSS</a></li>
                </ul>
              </div>
        </div>
    </div>
</div>


<div class="container-fluid">
    <div class="row">
        <div class="col-md-3 hidden-xs">
            <div class="sidebar well">
Blog Sysadmin/DevOps on Github - GNU/Linux
</div>

<div class="sidebar well">
<h4>Links</h4>
<ul>
  <li><a href="http://tedezed.github.io/Celtic-Kubernetes/HTML">Celtic Kubernetes</a></li>
  <li><a href="https://twitter.com/zerrotajo">Twitter</a></li>
  <li><a href="https://www.thingiverse.com/tedezed/designs">Thingiverse</a></li>
  <li><a href="mailto:juanmanuel.torres@aventurabinaria.es">Mail</a></li>
</ul>

</div>

<div class="sidebar well">
    <h4>Recent Posts</h4>
    <ul>
        
          <li><a href="/2020/12/Install-amd-drivers-linux-debian-ubuntu">Install AMD drivers for Linux (Debian/Ubuntu)</a></li>
        
          <li><a href="/2020/04/Change-local-port-in-Sendmail">Change local port in Sendmail</a></li>
        
          <li><a href="/2019/10/Examples-Nanorc">Examples Nanorc</a></li>
        
          <li><a href="/2019/07/Massive-editor-json-for-Kubernetes">Massive editor json for Kubernetes</a></li>
        
          <li><a href="/2019/03/Ingress-TCP-UDP">Ingress TCP/UDP</a></li>
        
          <li><a href="/2019/03/Delete-namespace-in-perpetual-Terminating-state">Delete namespace in perpetual Terminating state</a></li>
        
          <li><a href="/2017/06/External-Load-Balancer-for-Kubernetes-HAProxy">External Load Balancer for Kubernetes - HAProxy</a></li>
        
          <li><a href="/2017/05/Galera-Cluster-on-Debian-8">Galera Cluster on Debian 8</a></li>
        
          <li><a href="/2017/02/Creaci%C3%B3n-publicacion-y-firma-de-claves-PGP">Creación, publicación y firma de claves PGP</a></li>
        
          <li><a href="/2016/08/Poblar-LDAP-desde-fichero-JSON-PAM-y-SSH-con-Clave-publica">Poblar LDAP desde fichero JSON [PAM y SSH con Clave publica]</a></li>
        
          <li><a href="/2016/08/Pantalla-LCD-16-2-y-PCF8574-(I2C)-para-Arduino">Pantalla LCD 16×2 y PCF8574 (I2C) para Arduino</a></li>
        
          <li><a href="/2016/08/Pantalla-LCD-16x2-y-PCF8574-(I2C)-para-Raspberry-pi">Pantalla LCD 16x2 y PCF8574 (I2C) para Raspberry pi</a></li>
        
    </ul>
</div>

        </div>
        <div class="col-md-6">
          <div class="article">
            <div class="well">
                <h1><a href="/2017/05/Galera-Cluster-on-Debian-8">Galera Cluster on Debian 8</a></h1>
                <h5>6 May, 2017</h5>
                <hr/>
            
                
                <p class="author"><a href="#disqus_thread" data-disqus-identifier="2017-05-galera-cluster-on-debian-8">Comments</a></p>
                
            
            <div class="post-content">
            <p>In this stage you need two nodes with Debian OS for deploy Galera Cluster Maria DB. The next entry add other two nodes with HAProxy and VIP for load balancer to Cluster.</p>

<p>The first step is add the repository of mariadb to Debian (Node1 and node2):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install software-properties-common
sudo apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 0xcbcb082a1bb943db
sudo add-apt-repository 'deb [arch=amd64,i386] http://mariadb.kisiek.net/repo/10.0/debian jessie main'
sudo apt-get update
sudo apt-get upgrade
</code></pre></div></div>

<p>When is done, install the software for Galera cluster (Node1 and node2):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get install -y rsync galera mariadb-galera-server
</code></pre></div></div>

<p>The next step is configure the file of configuration of Galera:</p>

<p>For node01:</p>
<pre class="highlight">
echo '[mysqld]
# MySQL Configuration
query_cache_size=0
binlog_format=ROW
default-storage-engine=<strong>innodb</strong>
innodb_autoinc_lock_mode=2
query_cache_type=0
bind-address=<strong>0.0.0.0</strong>

# Galera Provider Configuration
wsrep_provider=/usr/lib/galera/libgalera_smm.so
#wsrep_provider_options="gcache.size=32G"

# Galera Cluster Configuration
wsrep_cluster_name="test_cluster"
wsrep_cluster_address="<strong>gcomm://192.168.30.11:4567,192.168.30.12:4567</strong>"

# Galera Synchronization Congifuration
wsrep_sst_method=rsync
#wsrep_sst_auth=user:pass

# Galera Node Configuration
wsrep_node_address="<strong>192.168.30.11</strong>"
wsrep_node_name="<strong>node01</strong>"' &gt; /etc/mysql/conf.d/galera.cnf ; chmod 770 /etc/mysql/conf.d/galera.cnf
</pre>

<p>For node02:</p>
<pre class="highlight">
echo '[mysqld]
# MySQL Configuration
query_cache_size=0
binlog_format=ROW
default-storage-engine=<strong>innodb</strong>
innodb_autoinc_lock_mode=2
query_cache_type=0
bind-address=<strong>0.0.0.0</strong>

# Galera Provider Configuration
wsrep_provider=/usr/lib/galera/libgalera_smm.so
#wsrep_provider_options="gcache.size=32G"

# Galera Cluster Configuration
wsrep_cluster_name="test_cluster"
wsrep_cluster_address="<strong>gcomm://192.168.30.11:4567,192.168.30.12:4567</strong>"

# Galera Synchronization Congifuration
wsrep_sst_method=rsync
#wsrep_sst_auth=user:pass

# Galera Node Configuration
wsrep_node_address="<strong>192.168.30.12</strong>"
wsrep_node_name="<strong>node02</strong>"' &gt; /etc/mysql/conf.d/galera.cnf ; chmod 770 /etc/mysql/conf.d/galera.cnf
</pre>

<h4 id="bonus-configuration">BONUS configuration</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[mysql_safe]
log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid
</code></pre></div></div>

<p>Configure the file /etc/hosts (Node1 and node2):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>192.168.30.11 node01
192.168.30.12 node02
</code></pre></div></div>

<p>Copy file /etc/mysql/debian.cnf to the node01 to node02</p>

<p>Stop the service MySQL (Node1 and node2):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>service mysql stop
</code></pre></div></div>

<p>Execute the next command for create new cluster (Node1):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>service mysql start --wsrep-new-cluster
</code></pre></div></div>

<p><strong>ERROR:</strong> WSREP: gcs connect failed: Connection timed out
<strong>SOLUTION:</strong>
Execute:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>service mysql bootstrap
</code></pre></div></div>

<p>Restart all services of MySQL and Galera (Node1 and node2).</p>

<p>The next query response the number of nodes of cluster Galera:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -e 'SELECT VARIABLE_VALUE as "cluster size" FROM INFORMATION_SCHEMA.GLOBAL_STATUS WHERE VARIABLE_NAME="wsrep_cluster_size"' -p
</code></pre></div></div>

<p>Finish the first part.</p>

            </div>
            
                
            <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
                
            
            </div>
          </div>
          <div class="pagination">
              
                <a class="btn btn-default" href="/2017/06/External-Load-Balancer-for-Kubernetes-HAProxy" class="next">Newer Post</a>
              
              
                <a class="btn btn-default" href="/2017/02/Creaci%C3%B3n-publicacion-y-firma-de-claves-PGP" class="previous">Older Post</a>
              
          </div>
        </div>
        <div class="col-md-3 hidden-xs">
            <div class="sidebar well">
    <!--<h4>Twitter</h4>
    <a class="twitter-timeline" data-height="515" href="https://twitter.com/Zerrotajo?ref_src=twsrc%5Etfw">Tweets by Zerrotajo</a>
    <a href="https://twitter.com/intent/tweet?button_hashtag=sysadmin&ref_src=twsrc%5Etfw" class="twitter-hashtag-button" data-show-count="false">#sysadmin</a>
    <a href="https://twitter.com/intent/tweet?button_hashtag=kubernetes&ref_src=twsrc%5Etfw" class="twitter-hashtag-button" data-show-count="false">#kubernetes</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>-->
<h4>Kubernetes Containers Tools</h4>
  <ul>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/squirrel">Squirel secrets rotation</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/liberty">Liberty Ingress</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/secure_emailing">Secure Emailing Gateway</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/cloud-cementery/docker">Cloud Cementery</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/cron-backup-kubernetes">Backups for Kubernetes in yaml</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/backup-db-cron">Backups/Snapshots for all</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/sftp-multiuser">SFTP Multiuser</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/statefulset_autoscaler">StatefulSet autoscaler</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/tools/Kubernetes/concurrent-kubectl-gcloud">Concurrent kubectl gcloud</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/debian-box">Debian Box</a></li>
  </ul>
</div>


        </div>
    </div>
</div>


  <script type="text/javascript">
    var disqus_shortname = 'www-aventurabinaria-es';

    var disqus_config = function () {
        this.page.identifier = '2017-05-galera-cluster-on-debian-8';
    };

   (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>


<!--<div class="container-fluid">
    <div class="row-fluid">
        <div class="span12 footer navbar-inverse navbar-fixed-bottom">
            <p class="copyright">&copy;2022 Aventura Binaria. Powered by <a href="http://jekyllrb.com">Jekyll</a>, theme by <a href="https://github.com/scotte/jekyll-clean">Scott Emmons</a>
            under
            <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution</a></p>
        </div>
    </div>
</div>-->


  <script type="text/javascript">
    var disqus_shortname = 'www-aventurabinaria-es';

    var disqus_config = function () {
        this.page.identifier = '2017-05-galera-cluster-on-debian-8';
    };

   (function () {
     var s = document.createElement('script'); s.async = true;
     s.type = 'text/javascript';
     s.src = '//' + disqus_shortname + '.disqus.com/count.js';
     (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
   }());
 </script>


<!--
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-153422845-1"></script>
  <script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-153422845-1');
  </script>

-->

</body>
</html>

