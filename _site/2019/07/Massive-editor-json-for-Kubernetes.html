<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Aventura Binaria</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/css/theme_v2.css" rel="stylesheet" type="text/css">
    <link href="/css/syntax.css" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" type="image/png" href="https://www.aventurabinaria.es/images/favicon-32x32.png"/>


</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Aventura Binaria</a>
              </div>
              <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <!--<li class="active"><a href="/">Home</a></li>-->
                    <li class="active visible-xs-block"><a href="/links.html">Links</a></li>
                    <li class="nav-item"><a class="nav-link" href="/archive.html">Archive</a></li>
                    <!--<li class="active"><a href="/about.html">About</a></li>-->
                    <!--<li class="active"><a href="/space.html">Space</a></li>-->
                    
                    
                      <li class="nav-item"><a class="nav-link" href="https://github.com/Tedezed">Github</a></li>
                    
                    <li class="nav-item"><a class="nav-link" href="/feed.xml">RSS</a></li>
                </ul>
              </div>
        </div>
    </div>
</div>


<div class="container-fluid">
    <div class="row">
        <div class="col-md-3 hidden-xs">
            <div class="sidebar well">
Blog Sysadmin/DevOps on Github - GNU/Linux
</div>

<div class="sidebar well">
<h4>Links</h4>
<ul>
  <li><a href="http://tedezed.github.io/Celtic-Kubernetes/HTML">Celtic Kubernetes</a></li>
  <li><a href="https://twitter.com/zerrotajo">Twitter</a></li>
  <li><a href="https://www.thingiverse.com/tedezed/designs">Thingiverse</a></li>
  <li><a href="mailto:juanmanuel.torres@aventurabinaria.es">Mail</a></li>
</ul>

</div>

<div class="sidebar well">
    <h4>Recent Posts</h4>
    <ul>
        
          <li><a href="/2020/12/Install-amd-drivers-linux-debian-ubuntu">Install AMD drivers for Linux (Debian/Ubuntu)</a></li>
        
          <li><a href="/2020/04/Change-local-port-in-Sendmail">Change local port in Sendmail</a></li>
        
          <li><a href="/2019/10/Examples-Nanorc">Examples Nanorc</a></li>
        
          <li><a href="/2019/07/Massive-editor-json-for-Kubernetes">Massive editor json for Kubernetes</a></li>
        
          <li><a href="/2019/03/Ingress-TCP-UDP">Ingress TCP/UDP</a></li>
        
          <li><a href="/2019/03/Delete-namespace-in-perpetual-Terminating-state">Delete namespace in perpetual Terminating state</a></li>
        
          <li><a href="/2017/06/External-Load-Balancer-for-Kubernetes-HAProxy">External Load Balancer for Kubernetes - HAProxy</a></li>
        
          <li><a href="/2017/05/Galera-Cluster-on-Debian-8">Galera Cluster on Debian 8</a></li>
        
          <li><a href="/2017/02/Creaci%C3%B3n-publicacion-y-firma-de-claves-PGP">Creación, publicación y firma de claves PGP</a></li>
        
          <li><a href="/2016/08/Poblar-LDAP-desde-fichero-JSON-PAM-y-SSH-con-Clave-publica">Poblar LDAP desde fichero JSON [PAM y SSH con Clave publica]</a></li>
        
          <li><a href="/2016/08/Pantalla-LCD-16-2-y-PCF8574-(I2C)-para-Arduino">Pantalla LCD 16×2 y PCF8574 (I2C) para Arduino</a></li>
        
          <li><a href="/2016/08/Pantalla-LCD-16x2-y-PCF8574-(I2C)-para-Raspberry-pi">Pantalla LCD 16x2 y PCF8574 (I2C) para Raspberry pi</a></li>
        
    </ul>
</div>

        </div>
        <div class="col-md-6">
          <div class="article">
            <div class="well">
                <h1><a href="/2019/07/Massive-editor-json-for-Kubernetes">Massive editor json for Kubernetes</a></h1>
                <h5>16 Jul, 2019</h5>
                <hr/>
            
                
                <p class="author"><a href="#disqus_thread" data-disqus-identifier="2019-07-massive-editor-json-for-kubernetes">Comments</a></p>
                
            
            <div class="post-content">
            <p>In this post we will see the use of a custom bash (kmae and kselect) function that can save you time in your Kuberentes environments.</p>

<p>The idea is to interact with Kubernetes to be able to quickly edit a large amount of resources using grep filters; external (kubectl get pod) and internal (kubectl get pod -o json).</p>

<p>Code: <a href="https://gist.github.com/Tedezed/a8abece3507296c4fa1eb0ea70cc15e5">https://gist.github.com/Tedezed/a8abece3507296c4fa1eb0ea70cc15e5</a></p>

<blockquote>
  <p><strong>Kmae</strong>: It can be very dangerous if it is not used with caution, it saves three days of json edited to be able to recover them in the case of needing them in <code class="language-plaintext highlighter-rouge">$HOME/.kmae</code>.
You can create backup of your cluster in json using: <a href="https://github.com/Tedezed/kubernetes-resources/tree/master/kubebackup">https://github.com/Tedezed/kubernetes-resources/tree/master/kubebackup</a>
 </p>
</blockquote>

<p>To test it you can create an environment with several nginx with the following for:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for i in $(seq 1 6); do
  kubectl create namespace nginx-$i;
  kubectl create deploy nginx-$i -n nginx-$i --image=nginx;
done
</code></pre></div></div>
<p> 
<img src="https://www.aventurabinaria.es/images/posts/tty-kmae.gif" width="99%" alt="Gif tty" />
 </p>

<p>We will use kselect to test your filters in the first place:</p>

<p><strong>Format:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kselect (ENTITY) (GREP_EXTERNAL_KUBECTL) (GREP_INTERNAL_JSON) (JSON_PATH) (NAMESPACE OR --all-namespaces)
</code></pre></div></div>
<p><strong>Example:</strong> Get json path spec.strategy.rollingUpdate of the nginx with name nginx-1 to 3 and generation equal to 1 in all namespaces</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kselect deploy "(nginx-[1-3])" '"observedGeneration": 1' .spec.strategy.rollingUpdate --all-namespaces
</code></pre></div></div>
<p> </p>

<p>In the second place, modify the spec.strategy.rollingUpdate of the three deployments at the same command:</p>

<p><strong>Format:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kmae (ENTITY) (GREP_EXTERNAL_KUBECTL) (GREP_INTERNAL_JSON) (JSON_PATH_TO_UPDATE) (NAMESPACE OR --all-namespaces)
</code></pre></div></div>
<p><strong>Example:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kmae deploy "(nginx-[1-3])" '"observedGeneration": 1' '{"spec":{"strategy":{"rollingUpdate":{"maxUnavailable": "50%", "maxSurge": "45%"}}}}' --all-namespaces
</code></pre></div></div>
<p> </p>

<p>We tested the previous kselect that does not return anything because the generation number changed:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kselect deploy "(nginx-[1-3])" '"observedGeneration": 1' .spec.strategy.rollingUpdate --all-namespaces
</code></pre></div></div>

<p>If it works if we change the generation:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kselect deploy "(nginx-[1-3])" '"observedGeneration": 2' .spec.strategy.rollingUpdate --all-namespaces
</code></pre></div></div>
<p> </p>

<p>One last test with modification of replicas:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kselect deploy "(nginx-[1-3])" '"observedGeneration": 2' .spec.replicas --all-namespaces
kmae deploy "(nginx-[1-3])" '"observedGeneration": 2' '{"spec":{"replicas":2}}' --all-namespaces
kselect deploy "(nginx-[1-3])" '"observedGeneration": 3' .spec.replicas --all-namespaces
</code></pre></div></div>
<p> </p>

<p>Clean enviroment:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for i in $(seq 1 6); do 
  kubectl delete deploy nginx-$i -n nginx-$i --force --grace-period=0;
  kubectl delete namespace nginx-$i --force --grace-period=0; 
done
</code></pre></div></div>

            </div>
            
                
            <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
                
            
            </div>
          </div>
          <div class="pagination">
              
                <a class="btn btn-default" href="/2019/10/Examples-Nanorc" class="next">Newer Post</a>
              
              
                <a class="btn btn-default" href="/2019/03/Ingress-TCP-UDP" class="previous">Older Post</a>
              
          </div>
        </div>
        <div class="col-md-3 hidden-xs">
            <div class="sidebar well">
    <!--<h4>Twitter</h4>
    <a class="twitter-timeline" data-height="515" href="https://twitter.com/Zerrotajo?ref_src=twsrc%5Etfw">Tweets by Zerrotajo</a>
    <a href="https://twitter.com/intent/tweet?button_hashtag=sysadmin&ref_src=twsrc%5Etfw" class="twitter-hashtag-button" data-show-count="false">#sysadmin</a>
    <a href="https://twitter.com/intent/tweet?button_hashtag=kubernetes&ref_src=twsrc%5Etfw" class="twitter-hashtag-button" data-show-count="false">#kubernetes</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>-->
<h4>Kubernetes Containers Tools</h4>
  <ul>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/squirrel">Squirel secrets rotation</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/liberty">Liberty Ingress</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/secure_emailing">Secure Emailing Gateway</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/cloud-cementery/docker">Cloud Cementery</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/cron-backup-kubernetes">Backups for Kubernetes in yaml</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/backup-db-cron">Backups/Snapshots for all</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/sftp-multiuser">SFTP Multiuser</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/statefulset_autoscaler">StatefulSet autoscaler</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/tools/Kubernetes/concurrent-kubectl-gcloud">Concurrent kubectl gcloud</a></li>
    <li><a href="https://github.com/Tedezed/kubernetes-containers-tools/tree/master/debian-box">Debian Box</a></li>
  </ul>
</div>


        </div>
    </div>
</div>


  <script type="text/javascript">
    var disqus_shortname = 'www-aventurabinaria-es';

    var disqus_config = function () {
        this.page.identifier = '2019-07-massive-editor-json-for-kubernetes';
    };

   (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>


<!--<div class="container-fluid">
    <div class="row-fluid">
        <div class="span12 footer navbar-inverse navbar-fixed-bottom">
            <p class="copyright">&copy;2022 Aventura Binaria. Powered by <a href="http://jekyllrb.com">Jekyll</a>, theme by <a href="https://github.com/scotte/jekyll-clean">Scott Emmons</a>
            under
            <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution</a></p>
        </div>
    </div>
</div>-->


  <script type="text/javascript">
    var disqus_shortname = 'www-aventurabinaria-es';

    var disqus_config = function () {
        this.page.identifier = '2019-07-massive-editor-json-for-kubernetes';
    };

   (function () {
     var s = document.createElement('script'); s.async = true;
     s.type = 'text/javascript';
     s.src = '//' + disqus_shortname + '.disqus.com/count.js';
     (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
   }());
 </script>


<!--
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-153422845-1"></script>
  <script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-153422845-1');
  </script>

-->

</body>
</html>

